<!DOCTYPE html>
    <html lang="it">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>University Pathfinder - FAQ</title>
        <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    </head>

    <body>
        <h2>
            Utente registrato
        </h2> 
        <!-- FAQ List -->
        <div class="row">
            <% @faqs.each do |faq| %>
                <div class="col-lg-4 col-md-6 mb-4">
                    <div class="card faq-card h-100">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <span class="category-badge"><%= faq.categoria %></span>
                            </div>
                            <h6 class="card-subtitle mb-2 text-primary"><%= faq.domanda %></h6>
                            <p class="card-text text-muted"><%= faq.risposta %></p>
                        </div>
                    </div>
                </div>
            <% end %>
        </div>

        <!-- Empty State -->
        <% if @faqs.empty? %>
            <div class="col-12 text-center py-5">
                <i class="fas fa-question-circle fa-3x text-muted mb-3"></i>
                <h4 class="text-muted">Nessuna FAQ disponibile</h4>
                <p class="text-muted">Aggiungi la prima FAQ cliccando sul pulsante "Aggiungi FAQ".</p>
            </div>
        <% end %>



    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            initializeFAQPage();
        });

        function initializeFAQPage() {
            setupCategoryFilters();
            setupSearch();
            setupRatingSystem();
            showNewFAQNotification();
        }

        function setupCategoryFilters() {
            const categoryBtns = document.querySelectorAll('.category-btn');
            const faqCards = document.querySelectorAll('.faq-card');

            categoryBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    categoryBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    const selectedCategory = this.dataset.category;
                    filterFAQs(selectedCategory);
                });
            });
        }

        function filterFAQs(category) {
            const faqCards = document.querySelectorAll('.faq-card');
            let visibleCount = 0;

            faqCards.forEach(card => {
                if (category === 'all' || card.dataset.category === category) {
                    card.style.display = 'block';
                    visibleCount++;
                } else {
                    card.style.display = 'none';
                }
            });

            toggleEmptyState(visibleCount === 0);
        }

        function setupSearch() {
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', debounce(searchFAQs, 300));
        }

        function searchFAQs() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const faqCards = document.querySelectorAll('.faq-card');
            let visibleCount = 0;

            faqCards.forEach(card => {
                const question = card.querySelector('h5').textContent.toLowerCase();
                const answer = card.querySelector('.faq-body p').textContent.toLowerCase();
                const category = card.querySelector('.category-badge').textContent.toLowerCase();

                if (question.includes(searchTerm) || answer.includes(searchTerm) || category.includes(searchTerm)) {
                    card.style.display = 'block';
                    visibleCount++;
                } else {
                    card.style.display = 'none';
                }
            });

            toggleEmptyState(visibleCount === 0);
        }

        function setupRatingSystem() {
            const ratingBtns = document.querySelectorAll('.rating-btn');
            
            ratingBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const rating = parseInt(this.dataset.rating);
                    const container = this.parentElement;
                    const buttons = container.querySelectorAll('.rating-btn');
                    
                    buttons.forEach((button, index) => {
                        if (index < rating) {
                            button.classList.add('active');
                        } else {
                            button.classList.remove('active');
                        }
                    });
                    
                    showFeedbackConfirmation();
                });
            });
        }

        function showFeedbackConfirmation() {
            const toast = document.createElement('div');
            toast.className = 'toast position-fixed bottom-0 end-0 m-3';
            toast.innerHTML = `
                <div class="toast-header">
                    <i class="fas fa-check-circle text-success me-2"></i>
                    <strong class="me-auto">Grazie!</strong>
                    <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
                </div>
                <div class="toast-body">
                    Il tuo feedback Ã¨ stato registrato.
                </div>
            `;
            
            document.body.appendChild(toast);
            const bsToast = new bootstrap.Toast(toast);
            bsToast.show();
            
            setTimeout(() => {
                document.body.removeChild(toast);
            }, 3000);
        }

        function showNewFAQNotification() {
            setTimeout(() => {
                document.getElementById('newFaqBadge').style.display = 'inline-block';
            }, 2000);
        }

        function setLanguage(lang) {
            const langBtns = document.querySelectorAll('.lang-btn');
            langBtns.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        function toggleEmptyState(show) {
            const container = document.getElementById('faqContainer');
            const emptyState = document.getElementById('emptyState');
            
            if (show) {
                container.style.display = 'none';
                emptyState.style.display = 'block';
            } else {
                container.style.display = 'block';
                emptyState.style.display = 'none';
            }
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
    </script>
</body>
</html>